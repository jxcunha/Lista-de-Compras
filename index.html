<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FF9800" />
  <title>Lista de Compras</title>
  <link rel="icon" type="image/png" href="Carrinho.png" />
  <link rel="manifest" href="manifest.json" />
  <style>
    body {
      font-family: sans-serif;
      background-color: #fff8e1;
      margin: 0;
      padding: 1em;
    }
    header {
      background-color: #ff5722;
      text-align: center;
      padding: 1em;
      border-radius: 10px 10px 0 0;
      color: #fff;
    }
    header img { max-height: 100px; }
    .form {
      padding: 0.5em;
      background-color: #2196f3;
      border-radius: 0 0 10px 10px;
      display: flex;
      flex-direction: column;
      gap: 0.5em;
      color: white;
    }
    input, button {
      margin: 0.2em 0;
      padding: 0.3em 0.7em;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4caf50;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    /* barra de categoria + lupa */
    .categoria-barra {
      display: flex;
      gap: 0.5em;
      align-items: center;
    }
    .categoria-barra input { flex: 1; }
    .btn-lupa {
      background: #ff9800;
      border: 1px solid #e68a00;
      font-size: 1.1em;
      padding: 0.3em 0.6em;
    }
    ul { list-style: none; padding: 0; }
    li {
      font-size: 0.9em;
      background-color: #fff;
      margin: 0.1em 0;
      padding: 0.3em 0.7em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 6px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }
    .item-info { flex-grow: 1; padding: 0 1em; }
    .item-info.riscado { text-decoration: line-through; opacity: 0.6; }
    .actions button {
      margin-left: 0.5em;
      background-color: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <header>
    <img src="Carrinho.png" alt="Carrinho de supermercado" />
  </header>

  <div class="form">
    <input type="text" id="produto" placeholder="Produto" />
    <input type="text" id="quantidade" placeholder="Quantidade" />
    <div class="categoria-barra">
      <input type="text" id="categoria" placeholder="Categoria (use a lupa para filtrar)" />
      <button id="btnBuscar" class="btn-lupa" title="Filtrar por categoria">üîç</button>
    </div>
    <button id="btnIncluir">Incluir</button>
  </div>

  <ul id="lista" style="padding:0;"></ul>

  <script>
    // ===== Estado =====
    let lista = [];         // [{produto, quantidade, categoria, riscado}]
    let filtro = "";        // filtro por categoria (lowercase)

    // ===== Util =====
    function salvar() {
      localStorage.setItem('listaDeCompras', JSON.stringify(lista));
    }

    function carregar() {
      const dados = localStorage.getItem('listaDeCompras');
      lista = dados ? JSON.parse(dados) : [];
    }

    function escapeHtml(s) {
      return String(s)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // ===== Render =====
    function renderizar() {
      const ul = document.getElementById('lista');
      ul.innerHTML = '';
      const origem = filtro
        ? lista.filter(i => (i.categoria || '').toLowerCase().includes(filtro))
        : lista;

      origem.forEach((item, idx) => {
        const li = document.createElement('li');

        const info = document.createElement('div');
        info.className = 'item-info' + (item.riscado ? ' riscado' : '');
        info.innerHTML = '<strong>' + escapeHtml(item.produto || '') + '</strong> - ' +
                         escapeHtml(item.quantidade || '') + ' (' + escapeHtml(item.categoria || '') + ')';

        const marcar = document.createElement('button');
        marcar.title = item.riscado ? 'Desmarcar' : 'Marcar como comprado';
        marcar.textContent = '‚úèÔ∏è';
        marcar.onclick = () => {
          item.riscado = !item.riscado;
          salvar();
          renderizar();
        };

        const excluir = document.createElement('button');
        excluir.title = 'Excluir';
        excluir.textContent = 'üóëÔ∏è';
        excluir.onclick = () => {
          const i = lista.indexOf(item);
          if (i >= 0) {
            lista.splice(i, 1);
            salvar();
            renderizar();
          }
        };

        const acoes = document.createElement('div');
        acoes.className = 'actions';
        acoes.appendChild(marcar);
        acoes.appendChild(excluir);

        li.appendChild(info);
        li.appendChild(acoes);
        ul.appendChild(li);
      });
    }

    // ===== A√ß√µes =====
    function incluirItem() {
      const produto = document.getElementById('produto').value.trim();
      const quantidade = document.getElementById('quantidade').value.trim();
      const categoria = document.getElementById('categoria').value.trim();
      if (!produto) return;

      lista.push({ produto, quantidade, categoria, riscado: false });
      salvar();
      renderizar();

      document.getElementById('produto').value = '';
      document.getElementById('quantidade').value = '';
      // n√£o limpa categoria para facilitar inclus√£o em lote
      document.getElementById('produto').focus();
    }

    function aplicarFiltro() {
      const cat = document.getElementById('categoria').value.trim().toLowerCase();
      filtro = cat;
      renderizar();
    }

    // Reset autom√°tico do filtro quando o campo categoria fica vazio
    document.getElementById('categoria').addEventListener('input', () => {
      if ((document.getElementById('categoria').value || '').trim() === '') {
        filtro = '';
        renderizar();
      }
    });

    // ===== Eventos =====
    document.getElementById('btnIncluir').addEventListener('click', incluirItem);
    document.getElementById('btnBuscar').addEventListener('click', aplicarFiltro);
    ['produto','quantidade'].forEach(id => {
      document.getElementById(id).addEventListener('keydown', (e) => {
        if (e.key === 'Enter') incluirItem();
      });
    });

    // ===== Init =====
    carregar();
    renderizar();

    // PWA opcional: registra service worker se existir
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>
