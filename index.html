
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#FF9800">
  <title>Lista de Compras</title>
  <link rel="icon" type="image/png" href="Carrinho.png">
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: sans-serif;
      background-color: #fff8e1;
      margin: 0;
      padding: 1em;
    }
    header {
      background-color: #ff5722;
      text-align: center;
      padding: 1em;
      border-radius: 10px 10px 0 0;
    }
    header img {
      max-height: 100px;
    }
    .form {
      padding: 0.5em;
      background-color: #2196f3;
      border-radius: 0 0 10px 10px;
      display: flex;
      flex-direction: column;
      gap: 0.5em;
      color: white;
    }
    input, select, button {
      margin: 0.2em 0;
      padding: 0.3em 0.7em;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4caf50;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .categoria-barra {
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    .categoria-barra input {
      flex-grow: 1;
    }
    .categoria-barra button {
      background-color: #ff9800;
      color: white;
      font-size: 1.2em;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      font-size: 0.9em;
      background-color: #fff;
      margin: 0.1em 0;
      padding: 0.3em 0.7em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 6px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }
    .item-info {
      flex-grow: 1;
      padding: 0 1em;
    }
    .actions button {
      margin-left: 0.5em;
      background-color: transparent;
      border: none;
      cursor: pointer;
    }
    .export-import {
      margin-top: 1em;
      display: flex;
      gap: 1em;
      justify-content: center;
    }
  </style>
</head>
<body>
  <header>
    <img src="Carrinho.png" alt="Carrinho de supermercado">
  </header>

  <div class="form">
    <input type="text" id="produto" placeholder="Produto">
    <input type="text" id="quantidade" placeholder="Quantidade">
    <div class="categoria-barra">
      <input type="text" id="categoria" placeholder="Categoria">
      <button onclick="buscarPorCategoria()">üîç</button>
    </div>
    <button onclick="incluirItem()">Incluir</button>
  </div>

  <ul id="lista" style="padding:0;"></ul>

  <div class="export-import">
    <button id="btnExportar" onclick="exportarLista()">Exportar Lista</button>
    <button onclick="document.getElementById('arquivoImportacao').click()">Importar Lista</button>
    <input type="file" id="arquivoImportacao" accept=".json" style="display:none" onchange="importarLista()">
  </div>

  <script>
    let lista = [];
    let listaFiltrada = [];

    function salvarLista() {
      localStorage.setItem('listaDeCompras', JSON.stringify(lista));
    }

    function carregarLista() {
      const dados = localStorage.getItem('listaDeCompras');
      if (dados) {
        lista = JSON.parse(dados);
      }
    }

    function incluirItem() {
      const produto = document.getElementById('produto').value;
      const quantidade = document.getElementById('quantidade').value;
      const categoria = document.getElementById('categoria').value;
      if (!produto) return;
      lista.push({ produto, quantidade, categoria, riscado: false });
      salvarLista();
      renderizarLista();
      limparCampos();
    }

    function buscarPorCategoria() {
      const categoria = document.getElementById('categoria').value.toLowerCase();
      if (!categoria) {
        renderizarLista();
        return;
      }
      listaFiltrada = lista.filter(item => item.categoria.toLowerCase().includes(categoria));
      renderizarLista(true);
    }

    function limparCampos() {
      document.getElementById('produto').value = '';
      document.getElementById('quantidade').value = '';
      document.getElementById('categoria').value = '';
    }

    function renderizarLista(usandoFiltro = false) {
      const ul = document.getElementById('lista');
      ul.innerHTML = '';
      const origem = usandoFiltro ? listaFiltrada : lista;
      origem.forEach((item, index) => {
        const li = document.createElement('li');

        const info = document.createElement('div');
        info.className = 'item-info';
        info.innerHTML = `<strong>${item.produto}</strong> - ${item.quantidade} (${item.categoria})`;

        const marcar = document.createElement('button');
        marcar.innerHTML = '‚úèÔ∏è';
        marcar.onclick = () => {
          item.riscado = !item.riscado;
          salvarLista();
          renderizarLista();
        };

        const excluir = document.createElement('button');
        excluir.innerHTML = 'üóëÔ∏è';
        excluir.onclick = () => {
          lista.splice(lista.indexOf(item), 1);
          salvarLista();
          renderizarLista();
        };

        const divAcoes = document.createElement('div');
        divAcoes.className = 'actions';
        divAcoes.appendChild(marcar);
        divAcoes.appendChild(excluir);

        li.appendChild(info);
        li.appendChild(divAcoes);

        ul.appendChild(li);
      });
    }

    function exportarLista() {
      const data = JSON.stringify(lista, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'lista-compras.json';
      a.click();
    }

    function importarLista() {
      const file = document.getElementById('arquivoImportacao').files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          lista = JSON.parse(e.target.result);
          salvarLista();
          renderizarLista();
        } catch (err) {
          alert('Arquivo inv√°lido!');
        }
      };
      reader.readAsText(file);
    }

    carregarLista();
    renderizarLista();

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('Service Worker registrado!', reg))
          .catch(err => console.error('Erro ao registrar o Service Worker:', err));
      });
    }
  </script>
</body>
</html>
